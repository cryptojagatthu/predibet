<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Polymarket Live Markets</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col items-center">
  <header class="text-center py-8">
    <h1 class="text-3xl font-bold mb-2">üî• Polymarket Live Markets</h1>
    <p class="text-gray-400">Top 20 active markets sorted by volume</p>
  </header>

  <main id="marketList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-6 w-full max-w-6xl">
    <!-- Cards will be injected here -->
  </main>

  <footer class="mt-auto py-4 text-sm text-gray-500">
    Built with ‚ù§Ô∏è using Polymarket Gamma API
  </footer>

  <script>
    async function fetchMarkets() {
      const list = document.getElementById("marketList");
      list.innerHTML = `<div class='text-center col-span-full text-gray-400'>Loading markets...</div>`;

      try {
        const res = await fetch("/api/top20live");
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          list.innerHTML = `<div class='text-center col-span-full text-red-400'>No live markets found.</div>`;
          return;
        }

        list.innerHTML = "";
        data.forEach(m => {
          const outcomes = JSON.parse(m.outcomes || "[]");
          const prices = JSON.parse(m.outcomePrices || "[]");
          const vol = m.volume_num?.toLocaleString(undefined, { maximumFractionDigits: 2 });

          const card = document.createElement("div");
          card.className =
            "bg-gray-900 border border-gray-700 rounded-2xl shadow-lg p-4 flex flex-col hover:shadow-xl transition-all duration-300";

          card.innerHTML = `
            <img src="${m.image || 'https://polymarket.com/favicon.ico'}" alt="Market Image"
                 class="w-full h-40 object-cover rounded-xl mb-4 border border-gray-800">
            <h2 class="text-lg font-semibold mb-2">${m.question}</h2>
            <p class="text-sm text-gray-400 mb-2">${m.category || 'General'}</p>
            <p class="text-sm text-gray-300 mb-2">Volume: <span class="text-green-400 font-medium">$${vol}</span></p>
            <div class="flex flex-wrap gap-2 mt-auto">
              ${outcomes.map((o, i) => `
                <span class="text-xs bg-gray-800 px-3 py-1 rounded-full">
                  ${o}: ${prices[i] || "?"}
                </span>`).join("")}
            </div>
          `;

          list.appendChild(card);
        });
      } catch (e) {
        console.error(e);
        list.innerHTML = `<div class='text-center col-span-full text-red-400'>Error fetching markets.</div>`;
      }
    }

    fetchMarkets();
  </script>
</body>
</html>
